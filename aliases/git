# Aliases for GIT.
# Created by LounisBou

# Git create repo
function gcreate(){
    git init -b main
    git add .
    git commit -m "Initial commit"
}
function gcreate-remote(){
    # Create repo on github
    gh repo create $* --source=. --private --confirm --remote --push
}
# Git global
alias ga="git add $*"
alias gc="git commit -m $*"
alias gp="git push origin $*"
alias gpl="git pull"
alias gs="git status"
alias gcl="git clone $*"
# Git branch
alias gbr="git branch $*"
alias gbrd="git branch -d $*"
alias gbrD="git branch -D $*"
alias gbrm="git branch -m $*"
alias gbrM="git branch -M $*"
alias gbrv="git branch -v"
# Git log
function glg(){
    # Define variable nb_commits
    nb_commits=30
    # Check if $1 is not empty
    if [ ! -z "$1" ]
    then
        # Set $1 to nb_commits
        nb_commits=$1
    fi
    # Display git log
    git --no-pager log --graph --oneline --decorate --all -n $nb_commits
}
function gllc(){
    # Define variable nb_commits
    nb_commits=1
    # Check if $1 is not empty
    if [ ! -z "$1" ]
    then
        # Set $1 to nb_commits
        nb_commits=$1
    fi
    # Display git log
    git --no-pager log -$nb_commits
}
alias gdf="git diff"
# Git flow
alias gfi="git flow init"
alias gfs="git flow feature start $*"
alias gff="git flow feature finish $*"
function grs(){
    # Call git update
    git-update
    # Create release branch
    git flow release start $*
}
function grf(){
    # Get current branch name
    current_branch=$(git branch | grep \* | cut -d ' ' -f2)
    # Check if current branch is a release branch
    if [[ $current_branch == release/* ]]
    then
        # Get release version
        release_version=$(echo $current_branch | cut -d '/' -f2)
        echo "Finish release version: $release_version"
        # Finish release
        git flow release finish $release_version
        # Push tags
        git push origin --tags
        # Call git after mep
        git-after-mep
    else
        # Message error current branch is not a release branch
        echo "Error: Current branch is not a release branch"
    fi
}
function ghs(){
    # Call git update
    git-update
    # Create hotfix branch
    git flow hotfix start $*
}
function ghf(){
    # Get current branch name
    current_branch=$(git branch | grep \* | cut -d ' ' -f2)
    # Check if current branch is a hotfix branch
    if [[ $current_branch == hotfix/* ]]
    then
        # Get hotfix version
        hotfix_version=$(echo $current_branch | cut -d '/' -f2)
        echo "Finish hotfix version: $hotfix_version"
        # Finish hotfix
        git flow hotfix finish $hotfix_version
        # Push tags
        git push origin --tags
        # Call git after mep
        git-after-mep
    else
        # Message error current branch is not a hotfix branch
        echo "Error: Current branch is not a hotfix branch"
    fi
}
function gbs(){
    # Call git update
    git-update
    # Create bugfix branch
    git flow bugfix start $*
}
function gbf(){
    # Get current branch name
    current_branch=$(git branch | grep \* | cut -d ' ' -f2)
    # Check if current branch is a bugfix branch
    if [[ $current_branch == bugfix/* ]]
    then
        # Get bugfix version
        bugfix_version=$(echo $current_branch | cut -d '/' -f2)
        echo "Finish bugfix version: $bugfix_version"
        # Finish bugfix
        git flow bugfix finish $bugfix_version
        # Push tags
        git push origin --tags
        # Call git after mep
        git-after-mep
    else
        # Message error current branch is not a bugfix branch
        echo "Error: Current branch is not a bugfix branch"
    fi
}
# Checkout
alias gco="git checkout $*"
function gcft(){
    # Checkout feature branch
    git checkout feature/task/$*
}
function gcf(){
    # Checkout feature branch
    git checkout feature/$*
}
function gcr(){
    # Checkout release branch
    git checkout release/$*
}
function gch(){
    # Checkout hotfix branch
    git checkout hotfix/$*
}
function gcb(){
    # Checkout bugfix branch
    git checkout bugfix/$*
}
alias gcd="git checkout develop"
alias gcm="git checkout master"
alias gct="git checkout tests"
alias gcp="git checkout prod"
alias gcpp="git checkout preprod"
# Stash
alias gst="git stash"
alias gstl="git stash list"
alias gstp="git stash pop"
alias gstc="git stash clear"
# Merge
function gmf(){
    # Get current branch name
    current_branch=$(git branch | grep \* | cut -d ' ' -f2)
    # Checkout on feature branch
    git checkout feature/$*
    # Update feature branch
    git pull
    # Checkout on current branch
    git checkout $current_branch
    # Merge feature branch
    git merge feature/$* -m "Merge feature/$* in $current_branch"
}
function gmft(){
    # Get current branch name
    current_branch=$(git branch | grep \* | cut -d ' ' -f2)
    # Checkout on feature/task branch
    git checkout feature/task/$*
    # Update feature/task branch
    git pull
    # Checkout on current branch
    git checkout $current_branch
    # Merge feature task branch
    git merge feature/task/$* -m "Merge feature/task/$* in $current_branch"
}
function gmergin(){
    # Retrieve current branch name
    current_branch=$(git branch | grep \* | cut -d ' ' -f2)
    # Go to $1 branch
    git checkout $1
    # Merge current branch in $1 branch
    git merge $current_branch -m "Merge $current_branch in $1"
    # git add all
    git add .
    # git commit
    git commit -m "Merge $current_branch in $1"
    # Go back to current branch
    git checkout $current_branch
}
gmt="git mergetool"
# Push tag 
function gpt(){
    # Push all local tags
    git push origin --tags
    # Call git after mep
    git-after-mep
}
# Update
function git-update(){
    # Retrieve current branch name
    current_branch=$(git branch | grep \* | cut -d ' ' -f2)
    # Fetch all branches
    git fetch --all
    # Checkout develop branch
    git checkout develop
    # Update develop branch
    git pull 
    # Apply migration
    php artisan migrate
    # Checkout master branch
    git checkout master
    # Update master branch
    git pull
    # Checkout preprod branch
    git checkout preprod
    # Update preprod branch
    git pull
    # Checkout current branch
    git checkout $current_branch
    # Update current branch
    git pull
}
# After MEP
function git-after-mep(){
    # Retrieve current branch name
    current_branch=$(git branch | grep \* | cut -d ' ' -f2)
    # Checkout develop branch
    git checkout develop
    # Push develop branch
    git push
    # Checkout master branch
    git checkout master
    # Push master branch
    git push
    # Checkout current branch
    git checkout $current_branch
    # Push current branch
    git push
}
# Infos
alias ginfo="git config --list"